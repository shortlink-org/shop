# Common default values for temporal.
# This is a YAML-formatted file.
# Declare variables to be passed into your templates.

# ==============================================================================
# HTTPRoute: Istio Gateway â†’ Temporal Web UI
httpRoute:
  enabled: true
  parentRefs:
    - name: external-gateway
      namespace: istio-ingress
      sectionName: https
  hostnames:
    - temporal.shortlink.best
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /
      backendRefs:
        - name: temporal-web
          port: 8080

# ==============================================================================
temporal:
  enabled: true

  fullnameOverride: temporal

  serviceAccount:
    create: true

  server:
    replicaCount: 1

    # Resource configuration for Temporal server components
    # Requests are minimal for development, limits prevent runaway usage
    resources:
      requests:
        cpu: "50m"
        memory: "128Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"

    config:
      persistence: {}

    metrics:
      serviceMonitor:
        enabled: true

        additionalLabels:
          release: prometheus-operator

    frontend:
      metrics:
        serviceMonitor:
          enabled: true

    history:
      metrics:
        serviceMonitor:
          enabled: true

    matching:
      metrics:
        serviceMonitor:
          enabled: true

    worker:
      metrics:
        serviceMonitor:
          enabled: true

  web:
    # Resource configuration for Temporal Web UI
    resources:
      requests:
        cpu: "25m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"

    # Disable built-in ingress - using Istio Gateway instead
    ingress:
      enabled: false

  elasticsearch:
    enabled: true
    replicas: 1

    # Resource configuration for Elasticsearch (visibility store)
    resources:
      requests:
        cpu: "100m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

  cassandra:
    enabled: true

    persistence:
      storageClass: local-path
      size: 1Gi

    config:
      cluster_size: 1

    # Resource configuration for Cassandra (workflow persistence)
    resources:
      requests:
        cpu: "100m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

    exporter:
      enabled: false

  prometheus:
    enabled: false

  grafana:
    enabled: false
